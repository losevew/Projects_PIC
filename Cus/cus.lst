MPASM  5.42                           CUS.ASM   3-6-2012  22:21:51         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 
                      00002 ;--------------------------------- "ШАПКА"  ПРОГРАММЫ ----------------------------------------
                      00003 ;*********************************************************************************************
                      00004 ; Файл текста программы: cus_2.asm          ВАРИАНТ КОММЕНТАРИЯ № 2
                      00005 ; Программа разработана для устройства тонального вызова с частотой 1450 Гц.
                      00006 ;********************************************************************************************* 
                      00007 ; Автор: Корабельников Евгений Александрович  г.Липецк,  январь 2005г.
                      00008 ; E-mail: karabea@lipetsk.ru                   URL: http://ikarab.narod.ru
                      00009 ;*********************************************************************************************
                      00010 ; Используется микроконтроллер PIC16F84A. Частота кварца 4000кГц.
                      00011 ;*********************************************************************************************
                      00012 ; Объем программы: 46 слов в памяти программ.
                      00013 ;*********************************************************************************************
                      00014 
                      00015 ;=============================================================================================
                      00016 ; В "шапке" программы используются директивы: LIST, __CONFIG, equ, org.
                      00017 ;============================================================================================= 
                      00018             LIST       p=16F84A    ; Назначение типа ПИКа: PIC16F84A.
2007   3FF5           00019             __CONFIG   03FF5H      ; Установка битов  конфигурации: стандартный XT-генератор,
                      00020                                    ; WDT включен, бит защиты не установлен, PWRT
                      00021                                    ; включен (1111 0101).
                      00022 ;=============================================================================================
                      00023 ; Определение адресов регистров специального назначения.
                      00024 ;=============================================================================================
  00000001            00025 OptionR     equ        01h         ; Регистр Option - банк1
  00000003            00026 Status      equ        03h         ; Регистр Status
  00000006            00027 PortB       equ        06h         ; Порт B
  00000006            00028 TrisB       equ        06h         ; Регистр Tris B - Банк1
  0000000B            00029 IntCon      equ        0Bh         ; Регистр IntCon
                      00030 ;=============================================================================================
                      00031 ; Определение названия и адресов регистров общего назначения.
                      00032 ;=============================================================================================
  0000000C            00033 Sec         equ        0Ch         ; Счетчик времени полупериода.
                      00034 
  0000000D            00035 SecH        equ        0Dh         ; Старший байт таймера.
  0000000E            00036 SecL        equ        0Eh         ; Младший байт таймера.
                      00037 ;=============================================================================================
                      00038 ; Присвоение буквенного обозначения операции направления результата выполнения команды в
                      00039 ; регистр, с содержимым которого производится действие (для удобства восприятия текста
                      00040 ; программы).
                      00041 ;=============================================================================================
  00000001            00042 F           equ        1           ; Результат направить в регистр, с содержимым которого
                      00043                                    ; производится действие.
                      00044 ;=============================================================================================
                      00045 ; Присвоение биту выбора банка регистра STATUS (пятому) его стандартного названия 
                      00046 ; для удобства восприятия текста программы).
                      00047 ;=============================================================================================
  00000005            00048 RP0         equ        5           ; Присвоение 5-му биту регистра STATUS названия RP0.
                      00049 ;=============================================================================================
                      00050 ; Определение точки входа в программу.
                      00051 ;=============================================================================================
0000                  00052             org        0           ; Установка нулевого адреса в счетчике команд PC.
0000   2801           00053             goto       START       ; Безусловный переход на подпрограмму START.
MPASM  5.42                           CUS.ASM   3-6-2012  22:21:51         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00054 ;*********************************************************************************************
                      00055 
                      00056 ;------------------------------- РАБОЧАЯ  ЧАСТЬ  ПРОГРАММЫ -----------------------------------
                      00057 ;*********************************************************************************************
                      00058 ; Подготовительные операции.
                      00059 ;---------------------------------------------------------------------------------------------
0001   018B           00060 START       clrf       IntCon      ; Сброс в ноль всех битов регистра IntCon.
                      00061 
0002   0064           00062             clrwdt                 ; Установка начала отсчета сторожевого таймера WDT.
                      00063 
0003   1683           00064             bsf        Status,RP0  ; Установка 5-го бита регистра Status в единицу.
                      00065 
0004   3041           00066             movlw      .65         ; Запись в регистр W константы .65        (.65 = 0100 0001)
0005   0086           00067             movwf      TrisB       ; Установка нулевого и 6-го бита регистра TrisB
                      00068                                    ; в единицу, а остальных - в ноль.
                      00069 
0006   308F           00070             movlw      .143        ; Запись в регистр W константы .143      (.143 = 1000 1111)
0007   0081           00071             movwf      OptionR     ; Установка 4,5,6-го битов регистра OptionR  
                      00072                                    ; в ноль, а остальных - в единицу.
                      00073 
0008   1283           00074             bcf        Status,RP0  ; Установка 5-го бита регистра Status в ноль.                        
                      00075 ;--------------------------------------------------------------------------------------------
                      00076 ; Запись констант времени работы таймера.
                      00077 ;--------------------------------------------------------------------------------------------
0009   300F           00078             movlw      .15         ; Запись в регистр W константы .15
000A   008D           00079             movwf      SecH        ; Копирование константы .15 из регистра W в регистр SecH.
                      00080 
000B   30FF           00081             movlw      .255        ; Запись в регистр W константы .255
000C   008E           00082             movwf      SecL        ; Копирование константы .255 из регистра W в регистр SecL.
                      00083 ;--------------------------------------------------------------------------------------------
                      00084 ; Проверка наличия включения на передачу (опрос клавиатуры).
                      00085 ;--------------------------------------------------------------------------------------------
000D   1806           00086 CYCLE       btfsc      PortB,0     ; Если нулевой бит регистра PortB равен 1, то выполняется
                      00087                                    ; следующая команда (goto START), а если равен 0, то сле-
                      00088                                    ; дующая команда не выполняется (вместо нее - nop) и
                      00089                                    ; следующей активной командой будет btfss PortB,6
                      00090 
000E   2801           00091             goto       START       ; Безусловный переход на подпрограмму START.
                      00092 ;--------------------------------------------------------------------------------------------
                      00093 ; Проверка: режим тонального вызова включен или выключен ?
                      00094 ;--------------------------------------------------------------------------------------------
000F   1F06           00095             btfss      PortB,6     ; Если 6-й бит регистра PortB равен 0, то выполняется сле-
                      00096                                    ; дующая команда (goto PRD), а если равен 1, то следующая
                      00097                                    ; команда не выполняется (вместо нее - nop) и следующей
                      00098                                    ; активной командой будет bcf PortB,2
                      00099 
0010   2828           00100             goto       PRD         ; Безусловный переход на подпрограмму PRD. 
                      00101 ;--------------------------------------------------------------------------------------------
                      00102 ; Формирование времени отрицательного полупериода сигнала тонального вызова.
                      00103 ;--------------------------------------------------------------------------------------------
0011   1106           00104             bcf        PortB,2     ; Установить 2-й бит регистра PortB в 0.
0012   0000           00105             nop                    ; Пустые машинные циклы.
0013   0000           00106             nop                    ; ----------"-----------
MPASM  5.42                           CUS.ASM   3-6-2012  22:21:51         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0014   0000           00107             nop                    ; ----------"-----------
                      00108       
0015   3055           00109             movlw      .85         ; Запись в регистр W константы .85 
0016   008C           00110             movwf      Sec         ; Копирование константы .85 из регистра W в регистр Sec.
                      00111 
0017   0064           00112 PAUSE_1     clrwdt                 ; Установка начала отсчета сторожевого таймера WDT.
                      00113           
0018   0B8C           00114             decfsz     Sec,F       ; Декремент (-1) содержимого регистра Sec с сохранением
                      00115                                    ; результата декремента в нем же.
                      00116                                    ; Если этот результат не=0, то выполняется следующая коман-
                      00117                                    ; да (goto PAUSE_1), а если =0, то следующая команда не
                      00118                                    ; выполняется (вместо нее - nop) и следующей активной
                      00119                                    ; командой будет bsf PortB,2
                      00120 
0019   2817           00121             goto       PAUSE_1     ; Безусловный переход на подпрограмму PAUSE_1.
                      00122 ;--------------------------------------------------------------------------------------------
                      00123 ; Формирование времени положительного полупериода сигнала тонального вызова.
                      00124 ;--------------------------------------------------------------------------------------------           
                                       
001A   1506           00125             bsf        PortB,2     ; То же самое, что и при формировании
001B   0000           00126             nop                    ; отрицательного полупериода, только
001C   0000           00127             nop                    ; 2-й бит регистра PortB
001D   0000           00128             nop                    ; устанавливается в 1.
                      00129 
001E   3053           00130             movlw      .83         ; То же самое, что и при формировании отрицательного полу- 
001F   008C           00131             movwf      Sec         ; периода, только в регистр Sec записывается константа .83
                      00132 
0020   0064           00133 PAUSE_2     clrwdt                 ; Установка начала отсчета сторожевого таймера WDT.
                      00134           
0021   0B8C           00135             decfsz     Sec,F       ; То же самое, что и при формировании отрицательного полу-
0022   2820           00136             goto       PAUSE_2     ; периода, только безусловный переход осуществляется
                      00137                                    ; на подпрограмму PAUSE_2.
                      00138 ;--------------------------------------------------------------------------------------------
                      00139 ; "Очистка" (декремент) таймера.
                      00140 ;--------------------------------------------------------------------------------------------          
0023   0B8E           00141             decfsz     SecL,F      ; Декремент (-1) содержимого регистра SecL с сохранением
0024   280D           00142             goto       CYCLE       ; результата в нем же.                    
                      00143                                    ; Если этот результат не=0, то выполняется следующая коман-
                      00144                                    ; да (goto CYCLE), а если =0, то следующая команда не
                      00145                                    ; выполняется (вместо нее - nop) и следующей активной
                      00146                                    ; командой будет decfsz SecH,F
                      00147 
0025   0B8D           00148             decfsz     SecH,F      ; То же самое, что и при декременте содержимого регистра
0026   280D           00149             goto       CYCLE       ; SecL, только применительно к регистру SecH.
                      00150 
0027   1106           00151             bcf        PortB,2     ; Установить 2-й бит регистра PortB в 0.
                      00152 ;--------------------------------------------------------------------------------------------
                      00153 ; Уход рабочей точки программы в "вечное" кольцо и выход из него после
                      00154 ; переключения р/станции с передачи на прием.
                      00155 ;--------------------------------------------------------------------------------------------
0028   0064           00156 PRD         clrwdt                 ; Установка начала отсчета сторожевого таймера WDT.
                      00157 
                      00158 
MPASM  5.42                           CUS.ASM   3-6-2012  22:21:51         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0029   1C06           00159             btfss      PortB,0     ; Если нулевой бит регистра PortB равен 0, то выполняется
                      00160                                    ; следующая команда (goto PRD), а если равен 1, то сле-
                      00161                                    ; дующая команда не выполняется (вместо нее - nop) и
                      00162                                    ; следующей активной командой будет btfss PortB,0
                      00163  
002A   2828           00164             goto       PRD         ; Безусловный переход на подпрограмму PRD.
                      00165                                     
                      00166 ;           Еще одна проверка.
                      00167 
002B   1C06           00168             btfss      PortB,0     ; То же самое, что и при первой проверке, только, при
                      00169                                    ; равенстве нулевого бита регистра PortB единице, 
                      00170                                    ; следующей активной командой будет goto START.
                      00171  
002C   2828           00172             goto       PRD         ; Безусловный переход на подпрограмму PRD.
                      00173 
002D   2801           00174             goto       START       ; Безусловный переход на подпрограмму START. 
                      00175        
                      00176 ;============================================================================================
                      00177             end                    ; Директива конца текста программы.
MPASM  5.42                           CUS.ASM   3-6-2012  22:21:51         PAGE  5


SYMBOL TABLE
  LABEL                             VALUE 

CYCLE                             0000000D
F                                 00000001
IntCon                            0000000B
OptionR                           00000001
PAUSE_1                           00000017
PAUSE_2                           00000020
PRD                               00000028
PortB                             00000006
RP0                               00000005
START                             00000001
Sec                               0000000C
SecH                              0000000D
SecL                              0000000E
Status                            00000003
TrisB                             00000006
__16F84A                          00000001


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXX-- ----------------
2000 : -------X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:    46
Program Memory Words Free:   978


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,     0 suppressed

