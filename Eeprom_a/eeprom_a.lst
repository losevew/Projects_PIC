MPASM  5.42                      EEPROM_A.ASM   3-12-2012  21:34:04         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;***********************************************************************************************
                      00002 ;*************************** РАБОТА С EEPROM ПАМЯТЬЮ ДАННЫХ ************************************
                      00003 ;***********************************************************************************************
                      00004 
                      00005 
                      00006 ;***********************************************************************************************
                      00007 ;                                 "ШАПКА ПРОГРАММЫ"
                      00008 ;===============================================================================================
                      00009 ;.............................................................
                      00010 ;.............................................................
                      00011 ;===============================================================================================
                      00012 ; Определение положения регистров специального назначения. 
                      00013 ;===============================================================================================
  0000000B            00014 Intcon      equ        0Bh         ; Регистр Intcon.
  00000003            00015 Status      equ        03h         ; Регистр Status.
  00000008            00016 EEData      equ        08h         ; EEPROM - данные
  00000008            00017 EECon1      equ        08h         ; EECON1 - банк1.
  00000009            00018 EEAdr       equ        09h         ; EEPROM - адрес
  00000009            00019 EECon2      equ        09h         ; EECON2 - банк1.
                      00020 ;.............................................................
                      00021 ;.............................................................
                      00022 ;===============================================================================================
                      00023 ; Определение названия и положения регистров общего назачения.
                      00024 ;===============================================================================================
  0000000C            00025 Registr     equ        0Ch         ; Регистр оперативной памяти, используемый при работе с EEPROM.
                      00026 ;.............................................................
                      00027 ;.............................................................
                      00028 ;===============================================================================================
                      00029 ; Определение места размещения результатов операций.
                      00030 ;===============================================================================================
  00000000            00031 W           equ        0           ; Результат направить в аккумулятор.
  00000001            00032 F           equ        1           ; Результат направить в регистр.
                      00033 ;===============================================================================================
                      00034 ; Присваивание битам названий.
                      00035 ;===============================================================================================
  00000005            00036 RP0         equ        5           ; Бит выбора банка.
  00000007            00037 GIE         equ        7           ; Бит глобального разрешения прерываний.
                      00038 ;===============================================================================================
2100                  00039             org        2100h       ; Обращение к EEPROM памяти данных.
2100   0000 0000 0064 00040             DE         0h,0h,64h   ; Записать в ячейки с адресами .0, .1, .2 
                      00041                                    ; числа 0h, 0h, 64h (.100) соответственно.  
2103   0000 0000 0000 00042             DE         0h,0h,0h    ; Записать в ячейки с адресами .3, .4, .5
                      00043                                    ; числа 0h, 0h, 0h соответственно.
2106   004B 006F 0072 00044             DE         "Korabelnikow E.A. Rus. Lipetsk. 03.2005"  ; Записать в ячейки с адресами
       0061 0062 0065 
       006C 006E 0069 
       006B 006F 0077 
       0020 0045 002E 
       0041 002E 0020 
       0052 0075 0073 
       002E 0020 004C 
       0069 0070 0065 
       0074 0073 006B 
MPASM  5.42                      EEPROM_A.ASM   3-12-2012  21:34:04         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

       002E 0020 0030 
       0033 002E 0032 
       0030 0030 0035 
                      00045                                                                   ; с .6 по .46 символы.
                      00046 ;===============================================================================================
0000                  00047             org        0           ; Начать выполнение программы 
0000   2801           00048             goto       START       ; с подпрограммы START.
                      00049 ;***********************************************************************************************
                      00050 
                      00051 ;------------------------------------------------------------------------------------------------
                      00052 ;                              ПОЯСНЕНИЯ ПО ДИРЕКТИВЕ DE
                      00053 ;------------------------------------------------------------------------------------------------
                      00054 ;                                                       Содержимое EEPROM
                      00055 ;  1.   Для  случая, указанного --->     00 00 64 00 00 00 xx xx   xx xx xx xx xx xx xx xx
                      00056 ;       в "шапке" программы     --->     xx xx xx xx xx xx xx xx   xx xx xx xx xx xx xx xx
                      00057 ;                               --->     xx xx xx xx xx xx xx xx   xx xx xx xx xx xx xx FF
                      00058 ;                               --->     FF FF FF FF FF FF FF FF   FF FF FF FF FF FF FF FF
                      00059 ;                                     xx - 16-ричные числа символов, включая и пробелы.
                      00060 ;------------------------------------------------------------------------------------------------       
                                                             
                      00061 ;  2.           А можно и так:
                      00062 
                      00063 ;            org        2100h   --->     00 00 64 FF FF FF FF FF   FF FF FF FF FF FF FF FF
                      00064 ;            DE         0h,0h,64h-->     FF FF FF FF FF FF FF FF   FF FF FF FF FF FF FF FF
                      00065 ;                               --->     FF FF FF FF FF FF FF FF   FF FF FF FF FF FF FF FF
                      00066 ;                               --->     FF FF FF FF FF FF FF FF   FF FF FF FF FF FF FF FF
                      00067 ;------------------------------------------------------------------------------------------------
                      00068 
                      00069 ;***********************************************************************************************
                      00070 ;                               РАБОЧАЯ ЧАСТЬ ПРОГРАММЫ
                      00071 ;***********************************************************************************************
0001                  00072 START                              ; .........................
                      00073 ;.............................................................
                      00074 ;===============================================================================================
                      00075 ;                               Чтение данных из EEPROM
                      00076 ;===============================================================================================
                      00077 ; Считывание содержимого байта с адресом 02h и запись его в регистр общего назначения Registr.
                      00078 ;-----------------------------------------------------------------------------------------------
0001   1283           00079             bcf        Status,RP0  ; Переход в нулевой банк.
                      00080 
0002   3002           00081             movlw      2           ; Записать в регистр W константу 02h.
0003   0089           00082             movwf      EEAdr       ; Скопировать 02h из регистра W в регистр EEAdr.
                      00083 
0004   1683           00084             bsf        Status,RP0  ; Переход в первый банк.
0005   1408           00085             bsf        EECon1,0    ; Инициализировать чтение.
0006   1283           00086             bcf        Status,RP0  ; Переход в нулевой банк.
                      00087 
0007   0808           00088             movf       EEData,W    ; Скопировать число из ячейки EEPROM с адресом 02h в регистр W.
0008   008C           00089             movwf      Registr     ; Скопировать число из регистра W в регистр Registr.
                      00090 ;-----------------------------------------------------------------------------------------------
                      00091 ; Изменение содержимого регистра Registr.
                      00092 ;-----------------------------------------------------------------------------------------------
0009   0A8C           00093             incf       Registr,F   ; Увеличить на 1 содержимое регистра Registr с 
MPASM  5.42                      EEPROM_A.ASM   3-12-2012  21:34:04         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00094                                    ; сохранением результата в нем же.
                      00095 ;===============================================================================================
                      00096 ;                                Запись данных в EEPROM.             
                      00097 ;===============================================================================================
                      00098 ; Запись содержимого регистра Registr в ячейку EEPROM с адресом 02h.
                      00099 ;-----------------------------------------------------------------------------------------------
000A   138B           00100             bcf        Intcon,GIE  ; Глобальный запрет прерываний.
                      00101  
000B   3002           00102             movlw      2           ; Записать в регистр W константу 02h.
000C   0089           00103             movwf      EEAdr       ; Скопировать константу 02h из регистра W в регистр EEAdr.
                      00104  
000D   080C           00105             movf       Registr,W   ; Скопировать число из регистра Registr в регистр W.
000E   0088           00106             movwf      EEData      ; Скопировать число из регистра W в ячейку EEPROM с адресом 02h.
                      00107 
000F   1683           00108             bsf        Status,RP0  ; Переход в первый банк.
0010   1508           00109             bsf        EECon1,2    ; Разрешить запись. 
                      00110                                     
0011   3055           00111             movlw      055h        ; Обязательная
0012   0089           00112             movwf      EECon2      ; процедура
0013   30AA           00113             movlw      0AAh        ; при записи.
0014   0089           00114             movwf      EECon2      ; ----"----
0015   1488           00115             bsf        EECon1,1    ; ----"----
                      00116 
0016   1208           00117             bcf        EECon1,4    ; Сбросить флаг прерывания по окончании записи в EEPROM.
0017   1283           00118             bcf        Status,RP0  ; Переход в нулевой банк.
                      00119 ;------------------------------------------------------------------
                      00120 ; Примечание: время исполнения полного цикла программы должно быть 
                      00121 ; более времени, необходимого для окончания записи в EEPROM.
                      00122 ;------------------------------------------------------------------
                      00123 ;...................................................................
                      00124 ;...................................................................
0018   2801           00125             goto       START       ; Переход на новый цикл программы.
                      00126 ;***********************************************************************************************
                      00127             end                    ; Конец программы.
MPASM  5.42                      EEPROM_A.ASM   3-12-2012  21:34:04         PAGE  4


SYMBOL TABLE
  LABEL                             VALUE 

EEAdr                             00000009
EECon1                            00000008
EECon2                            00000009
EEData                            00000008
F                                 00000001
GIE                               00000007
Intcon                            0000000B
RP0                               00000005
Registr                           0000000C
START                             00000001
Status                            00000003
W                                 00000000
__16F84A                          00000001
__DEBUG                           1


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : XXXXXXXXXXXXXXXX XXXXXXXXX------- ---------------- ----------------
2100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXX--- ----------------

All other memory blocks unused.

Program Memory Words Used:    25
Program Memory Words Free:   999


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,     0 suppressed

